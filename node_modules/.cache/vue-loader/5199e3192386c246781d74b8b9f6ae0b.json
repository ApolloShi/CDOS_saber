{"remainingRequest":"/Users/shiliangliang/6cloud/saber/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/shiliangliang/6cloud/saber/src/views/flow/deploy.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/shiliangliang/6cloud/saber/src/views/flow/deploy.vue","mtime":1675244276627},{"path":"/Users/shiliangliang/6cloud/saber/node_modules/cache-loader/dist/cjs.js","mtime":1676864065065},{"path":"/Users/shiliangliang/6cloud/saber/node_modules/babel-loader/lib/index.js","mtime":1676864056051},{"path":"/Users/shiliangliang/6cloud/saber/node_modules/cache-loader/dist/cjs.js","mtime":1676864065065},{"path":"/Users/shiliangliang/6cloud/saber/node_modules/vue-loader/lib/index.js","mtime":1676864065555}],"contextDependencies":[],"result":["\r\n  import {deployUpload} from \"@/api/flow/flow\";\r\n  import {flowCategory} from \"@/util/flow\";\r\n\r\n  export default {\r\n    data() {\r\n      return {\r\n        form: {\r\n          flowCategory: '',\r\n          tenantId: '',\r\n          flowFile: [],\r\n          file: {},\r\n        },\r\n        option: {\r\n          labelWidth: 120,\r\n          menuBtn: false,\r\n          column: [\r\n            {\r\n              label: '流程类型',\r\n              prop: 'flowCategory',\r\n              type: 'select',\r\n              dicUrl: `/api/blade-system/dict/dictionary?code=flow`,\r\n              props: {\r\n                label: \"dictValue\",\r\n                value: \"dictKey\"\r\n              },\r\n              row: true,\r\n              span: 12,\r\n              dataType: \"number\",\r\n              rules: [\r\n                {\r\n                  required: true,\r\n                  message: '请选择流程类型',\r\n                  trigger: 'blur'\r\n                }\r\n              ]\r\n            },\r\n            {\r\n              label: \"流程模式\",\r\n              prop: \"flowMode\",\r\n              type: \"radio\",\r\n              dicData: [\r\n                {\r\n                  label: \"通用流程\",\r\n                  value: 1\r\n                },\r\n                {\r\n                  label: \"定制流程\",\r\n                  value: 2\r\n                }\r\n              ],\r\n              value: 1,\r\n              row: true,\r\n              span: 12,\r\n              rules: [\r\n                {\r\n                  required: true,\r\n                  message: '请选择流程模式',\r\n                  trigger: 'blur'\r\n                }\r\n              ],\r\n            },\r\n            {\r\n              label: \"所属租户\",\r\n              prop: \"tenantId\",\r\n              type: \"tree\",\r\n              multiple: true,\r\n              dicUrl: \"/api/blade-system/tenant/select\",\r\n              props: {\r\n                label: \"tenantName\",\r\n                value: \"tenantId\"\r\n              },\r\n              display: false,\r\n              row: true,\r\n              span: 12,\r\n              rules: [\r\n                {\r\n                  required: true,\r\n                  message: '请选择所属租户',\r\n                  trigger: 'blur'\r\n                }\r\n              ],\r\n            },\r\n            {\r\n              label: '附件上传',\r\n              prop: 'flowFile',\r\n              type: 'upload',\r\n              loadText: '附件上传中，请稍等',\r\n              span: 24,\r\n              propsHttp: {\r\n                res: 'data'\r\n              },\r\n              tip: '请上传 bpmn20.xml 标准格式文件',\r\n              action: '/api/blade-flow/manager/check-upload'\r\n            },\r\n          ]\r\n        }\r\n      }\r\n    },\r\n    watch: {\r\n      'form.flowMode'() {\r\n        this.$refs.form.option.column.filter(item => {\r\n          if (item.prop === \"tenantId\") {\r\n            item.display = this.form.flowMode === 2;\r\n          }\r\n        });\r\n      }\r\n    },\r\n    methods: {\r\n      uploadBefore(file, done) {\r\n        this.$message.success('部署开始');\r\n        this.file = file;\r\n        done()\r\n      },\r\n      uploadAfter(res, done, loading) {\r\n        if (!this.form.flowCategory) {\r\n          this.$message.warning('清先选择流程类型');\r\n          loading()\r\n          return false;\r\n        }\r\n        if (this.form.flowMode === 2 && !this.form.tenantId) {\r\n          this.$message.warning('清先选择对应租户');\r\n          loading();\r\n          return false;\r\n        }\r\n        if (res.success) {\r\n          deployUpload(\r\n            flowCategory(this.form.flowCategory),\r\n            (this.form.tenantId) ? this.form.tenantId.join(\",\") : \"\",\r\n            [this.file]\r\n          ).then(res => {\r\n            const data = res.data;\r\n            if (data.success) {\r\n              done()\r\n            } else {\r\n              this.$message.error(data.msg);\r\n              loading()\r\n            }\r\n          })\r\n        } else {\r\n          this.$message.warning('请上传 bpmn20.xml 标准格式文件');\r\n          loading()\r\n          return false;\r\n        }\r\n      },\r\n    }\r\n  }\r\n",{"version":3,"sources":["deploy.vue"],"names":[],"mappings":";AAOA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"deploy.vue","sourceRoot":"src/views/flow","sourcesContent":["<template>\r\n  <basic-container>\r\n    <avue-form ref=\"form\" :option=\"option\" v-model=\"form\" :upload-before=\"uploadBefore\" :upload-after=\"uploadAfter\"/>\r\n  </basic-container>\r\n</template>\r\n\r\n<script>\r\n  import {deployUpload} from \"@/api/flow/flow\";\r\n  import {flowCategory} from \"@/util/flow\";\r\n\r\n  export default {\r\n    data() {\r\n      return {\r\n        form: {\r\n          flowCategory: '',\r\n          tenantId: '',\r\n          flowFile: [],\r\n          file: {},\r\n        },\r\n        option: {\r\n          labelWidth: 120,\r\n          menuBtn: false,\r\n          column: [\r\n            {\r\n              label: '流程类型',\r\n              prop: 'flowCategory',\r\n              type: 'select',\r\n              dicUrl: `/api/blade-system/dict/dictionary?code=flow`,\r\n              props: {\r\n                label: \"dictValue\",\r\n                value: \"dictKey\"\r\n              },\r\n              row: true,\r\n              span: 12,\r\n              dataType: \"number\",\r\n              rules: [\r\n                {\r\n                  required: true,\r\n                  message: '请选择流程类型',\r\n                  trigger: 'blur'\r\n                }\r\n              ]\r\n            },\r\n            {\r\n              label: \"流程模式\",\r\n              prop: \"flowMode\",\r\n              type: \"radio\",\r\n              dicData: [\r\n                {\r\n                  label: \"通用流程\",\r\n                  value: 1\r\n                },\r\n                {\r\n                  label: \"定制流程\",\r\n                  value: 2\r\n                }\r\n              ],\r\n              value: 1,\r\n              row: true,\r\n              span: 12,\r\n              rules: [\r\n                {\r\n                  required: true,\r\n                  message: '请选择流程模式',\r\n                  trigger: 'blur'\r\n                }\r\n              ],\r\n            },\r\n            {\r\n              label: \"所属租户\",\r\n              prop: \"tenantId\",\r\n              type: \"tree\",\r\n              multiple: true,\r\n              dicUrl: \"/api/blade-system/tenant/select\",\r\n              props: {\r\n                label: \"tenantName\",\r\n                value: \"tenantId\"\r\n              },\r\n              display: false,\r\n              row: true,\r\n              span: 12,\r\n              rules: [\r\n                {\r\n                  required: true,\r\n                  message: '请选择所属租户',\r\n                  trigger: 'blur'\r\n                }\r\n              ],\r\n            },\r\n            {\r\n              label: '附件上传',\r\n              prop: 'flowFile',\r\n              type: 'upload',\r\n              loadText: '附件上传中，请稍等',\r\n              span: 24,\r\n              propsHttp: {\r\n                res: 'data'\r\n              },\r\n              tip: '请上传 bpmn20.xml 标准格式文件',\r\n              action: '/api/blade-flow/manager/check-upload'\r\n            },\r\n          ]\r\n        }\r\n      }\r\n    },\r\n    watch: {\r\n      'form.flowMode'() {\r\n        this.$refs.form.option.column.filter(item => {\r\n          if (item.prop === \"tenantId\") {\r\n            item.display = this.form.flowMode === 2;\r\n          }\r\n        });\r\n      }\r\n    },\r\n    methods: {\r\n      uploadBefore(file, done) {\r\n        this.$message.success('部署开始');\r\n        this.file = file;\r\n        done()\r\n      },\r\n      uploadAfter(res, done, loading) {\r\n        if (!this.form.flowCategory) {\r\n          this.$message.warning('清先选择流程类型');\r\n          loading()\r\n          return false;\r\n        }\r\n        if (this.form.flowMode === 2 && !this.form.tenantId) {\r\n          this.$message.warning('清先选择对应租户');\r\n          loading();\r\n          return false;\r\n        }\r\n        if (res.success) {\r\n          deployUpload(\r\n            flowCategory(this.form.flowCategory),\r\n            (this.form.tenantId) ? this.form.tenantId.join(\",\") : \"\",\r\n            [this.file]\r\n          ).then(res => {\r\n            const data = res.data;\r\n            if (data.success) {\r\n              done()\r\n            } else {\r\n              this.$message.error(data.msg);\r\n              loading()\r\n            }\r\n          })\r\n        } else {\r\n          this.$message.warning('请上传 bpmn20.xml 标准格式文件');\r\n          loading()\r\n          return false;\r\n        }\r\n      },\r\n    }\r\n  }\r\n</script>\r\n"]}]}