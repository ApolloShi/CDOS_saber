{"remainingRequest":"/Users/shiliangliang/6cloud/saber/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/shiliangliang/6cloud/saber/src/views/system/tenant.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/shiliangliang/6cloud/saber/src/views/system/tenant.vue","mtime":1675244276642},{"path":"/Users/shiliangliang/6cloud/saber/node_modules/cache-loader/dist/cjs.js","mtime":1676864065065},{"path":"/Users/shiliangliang/6cloud/saber/node_modules/babel-loader/lib/index.js","mtime":1676864056051},{"path":"/Users/shiliangliang/6cloud/saber/node_modules/cache-loader/dist/cjs.js","mtime":1676864065065},{"path":"/Users/shiliangliang/6cloud/saber/node_modules/vue-loader/lib/index.js","mtime":1676864065555}],"contextDependencies":[],"result":["\r\nimport {getList, getDetail, remove, update, add, setting, datasource, packageInfo, packageSetting} from \"@/api/system/tenant\";\r\nimport {getDetail as packageDetail} from \"@/api/system/tenantpackage\";\r\nimport {mapGetters} from \"vuex\";\r\nimport {getMenuTree} from \"@/api/system/menu\";\r\nimport {validatenull} from \"@/util/validate\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      form: {},\r\n      selectionList: [],\r\n      query: {},\r\n      loading: true,\r\n      box: false,\r\n      datasourceBox: false,\r\n      packageBox: false,\r\n      packageSettingBox: false,\r\n      page: {\r\n        pageSize: 10,\r\n        currentPage: 1,\r\n        total: 0\r\n      },\r\n      option: {\r\n        height: 'auto',\r\n        calcHeight: 30,\r\n        tip: false,\r\n        searchShow: true,\r\n        searchMenuSpan: 6,\r\n        border: true,\r\n        index: true,\r\n        selection: true,\r\n        viewBtn: true,\r\n        dialogWidth: 900,\r\n        dialogClickModal: false,\r\n        column: [\r\n          {\r\n            label: \"租户ID\",\r\n            prop: \"tenantId\",\r\n            width: 100,\r\n            search: true,\r\n            addDisplay: false,\r\n            editDisplay: false,\r\n            span: 24,\r\n            rules: [{\r\n              required: true,\r\n              message: \"请输入租户ID\",\r\n              trigger: \"blur\"\r\n            }]\r\n          },\r\n          {\r\n            label: \"租户名称\",\r\n            prop: \"tenantName\",\r\n            search: true,\r\n            width: 180,\r\n            span: 24,\r\n            rules: [{\r\n              required: true,\r\n              message: \"请输入参数名称\",\r\n              trigger: \"blur\"\r\n            }]\r\n          },\r\n          {\r\n            label: \"联系人\",\r\n            prop: \"linkman\",\r\n            width: 100,\r\n            search: true,\r\n            rules: [{\r\n              required: true,\r\n              message: \"请输入联系人\",\r\n              trigger: \"blur\"\r\n            }]\r\n          },\r\n          {\r\n            label: \"联系电话\",\r\n            prop: \"contactNumber\",\r\n            width: 150,\r\n          },\r\n          {\r\n            label: \"联系地址\",\r\n            prop: \"address\",\r\n            span: 24,\r\n            minRows: 2,\r\n            type: \"textarea\",\r\n            hide: true,\r\n          },\r\n          {\r\n            label: \"账号额度\",\r\n            prop: \"accountNumber\",\r\n            width: 90,\r\n            slot: true,\r\n            addDisplay: false,\r\n            editDisplay: false,\r\n          },\r\n          {\r\n            label: \"过期时间\",\r\n            prop: \"expireTime\",\r\n            width: 180,\r\n            slot: true,\r\n            addDisplay: false,\r\n            editDisplay: false,\r\n          },\r\n          {\r\n            label: \"绑定域名\",\r\n            prop: \"domain\",\r\n            span: 24,\r\n          },\r\n          {\r\n            label: \"系统背景\",\r\n            prop: \"backgroundUrl\",\r\n            type: 'upload',\r\n            listType: 'picture-img',\r\n            dataType: 'string',\r\n            action: '/api/blade-resource/oss/endpoint/put-file',\r\n            propsHttp: {\r\n              res: 'data',\r\n              url: 'link',\r\n            },\r\n            hide: true,\r\n            span: 24,\r\n          },\r\n        ]\r\n      },\r\n      data: [],\r\n      settingForm: {},\r\n      settingOption: {\r\n        column: [\r\n          {\r\n            label: \"账号额度\",\r\n            prop: \"accountNumber\",\r\n            type: \"number\",\r\n            span: 24,\r\n          },\r\n          {\r\n            label: \"过期时间\",\r\n            prop: \"expireTime\",\r\n            type: \"date\",\r\n            format: \"yyyy-MM-dd hh:mm:ss\",\r\n            valueFormat: \"yyyy-MM-dd hh:mm:ss\",\r\n            span: 24,\r\n          },\r\n        ]\r\n      },\r\n      datasourceForm: {},\r\n      datasourceOption: {\r\n        column: [\r\n          {\r\n            label: \"数据源\",\r\n            prop: \"datasourceId\",\r\n            search: true,\r\n            span: 24,\r\n            type: \"select\",\r\n            dicUrl: \"/api/blade-develop/datasource/select\",\r\n            props: {\r\n              label: \"name\",\r\n              value: \"id\"\r\n            },\r\n            rules: [{\r\n              required: true,\r\n              message: \"请选择数据源\",\r\n              trigger: \"blur\"\r\n            }]\r\n          },\r\n        ]\r\n      },\r\n      packageForm: {},\r\n      packageOption: {\r\n        column: [\r\n          {\r\n            label: \"产品包\",\r\n            prop: \"packageId\",\r\n            search: true,\r\n            span: 24,\r\n            type: \"select\",\r\n            dicUrl: \"/api/blade-system/tenant-package/select\",\r\n            props: {\r\n              label: \"packageName\",\r\n              value: \"id\"\r\n            },\r\n            rules: [{\r\n              required: true,\r\n              message: \"请选择产品包\",\r\n              trigger: \"blur\"\r\n            }]\r\n          },\r\n          {\r\n            label: \"菜单预览\",\r\n            prop: \"menuId\",\r\n            span: 24,\r\n            type: \"tree\",\r\n            dicData: [],\r\n            hide: true,\r\n            multiple: true,\r\n            props: {\r\n              label: \"title\"\r\n            },\r\n          },\r\n        ]\r\n      },\r\n    };\r\n  },\r\n  watch: {\r\n    'packageForm.packageId'() {\r\n      if (!validatenull(this.packageForm.packageId)) {\r\n        packageDetail(this.packageForm.packageId).then(res => {\r\n          this.packageForm.menuId = res.data.data.menuId;\r\n          this.initData();\r\n        });\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapGetters([\"userInfo\", \"permission\"]),\r\n    permissionList() {\r\n      return {\r\n        addBtn: this.vaildData(this.permission.tenant_add, false),\r\n        viewBtn: this.vaildData(this.permission.tenant_view, false),\r\n        delBtn: this.vaildData(this.permission.tenant_delete, false),\r\n        editBtn: this.vaildData(this.permission.tenant_edit, false)\r\n      };\r\n    },\r\n    ids() {\r\n      let ids = [];\r\n      this.selectionList.forEach(ele => {\r\n        ids.push(ele.id);\r\n      });\r\n      return ids.join(\",\");\r\n    },\r\n    tenantId() {\r\n      return this.selectionList[0].tenantId;\r\n    }\r\n  },\r\n  methods: {\r\n    initData() {\r\n      getMenuTree().then(res => {\r\n        const column = this.findObject(this.packageOption.column, \"menuId\");\r\n        column.dicData = res.data.data;\r\n      });\r\n    },\r\n    rowSave(row, done, loading) {\r\n      add(row).then(() => {\r\n        this.onLoad(this.page);\r\n        this.$message({\r\n          type: \"success\",\r\n          message: \"操作成功!\"\r\n        });\r\n        done();\r\n      }, error => {\r\n        window.console.log(error);\r\n        loading();\r\n      });\r\n    },\r\n    rowUpdate(row, index, done, loading) {\r\n      update(row).then(() => {\r\n        this.onLoad(this.page);\r\n        this.$message({\r\n          type: \"success\",\r\n          message: \"操作成功!\"\r\n        });\r\n        done();\r\n      }, error => {\r\n        window.console.log(error);\r\n        loading();\r\n      });\r\n    },\r\n    rowDel(row) {\r\n      this.$confirm(\"确定将选择数据删除?\", {\r\n        confirmButtonText: \"确定\",\r\n        cancelButtonText: \"取消\",\r\n        type: \"warning\"\r\n      })\r\n        .then(() => {\r\n          return remove(row.id);\r\n        })\r\n        .then(() => {\r\n          this.onLoad(this.page);\r\n          this.$message({\r\n            type: \"success\",\r\n            message: \"操作成功!\"\r\n          });\r\n        });\r\n    },\r\n    beforeOpen(done, type) {\r\n      if ([\"view\"].includes(type)) {\r\n        getDetail(this.form.id).then(res => {\r\n          const data = res.data.data;\r\n          if (!(data.accountNumber > 0)) {\r\n            data.accountNumber = \"不限制\";\r\n          }\r\n          if (!data.expireTime) {\r\n            data.expireTime = \"不限制\";\r\n          }\r\n          this.form = data;\r\n        });\r\n      }\r\n      done();\r\n    },\r\n    searchReset() {\r\n      this.query = {};\r\n      this.onLoad(this.page);\r\n    },\r\n    searchChange(params, done) {\r\n      this.query = params;\r\n      this.page.currentPage = 1;\r\n      this.onLoad(this.page, params);\r\n      done();\r\n    },\r\n    selectionChange(list) {\r\n      this.selectionList = list;\r\n    },\r\n    selectionClear() {\r\n      this.selectionList = [];\r\n      this.$refs.crud.toggleSelection();\r\n    },\r\n    handleDelete() {\r\n      if (this.selectionList.length === 0) {\r\n        this.$message.warning(\"请选择至少一条数据\");\r\n        return;\r\n      }\r\n      this.$confirm(\"确定将选择数据删除?\", {\r\n        confirmButtonText: \"确定\",\r\n        cancelButtonText: \"取消\",\r\n        type: \"warning\"\r\n      })\r\n        .then(() => {\r\n          return remove(this.ids);\r\n        })\r\n        .then(() => {\r\n          this.onLoad(this.page);\r\n          this.$message({\r\n            type: \"success\",\r\n            message: \"操作成功!\"\r\n          });\r\n          this.$refs.crud.toggleSelection();\r\n        });\r\n    },\r\n    handleSetting() {\r\n      if (this.selectionList.length === 0) {\r\n        this.$message.warning(\"请选择至少一条数据\");\r\n        return;\r\n      }\r\n      if (this.selectionList.length === 1) {\r\n        getDetail(this.selectionList[0].id).then(res => {\r\n          const data = res.data.data;\r\n          this.settingForm.accountNumber = data.accountNumber;\r\n          this.settingForm.expireTime = data.expireTime;\r\n        });\r\n      } else {\r\n        this.settingForm.accountNumber = -1;\r\n        this.settingForm.expireTime = '';\r\n      }\r\n      this.box = true;\r\n    },\r\n    handleDatasource() {\r\n      if (this.selectionList.length === 0) {\r\n        this.$message.warning(\"请选择至少一条数据\");\r\n        return;\r\n      }\r\n      if (this.selectionList.length !== 1) {\r\n        this.$message.warning(\"只能选择一条数据\");\r\n        return;\r\n      }\r\n      getDetail(this.selectionList[0].id).then(res => {\r\n        const data = res.data.data;\r\n        this.datasourceForm.datasourceId = data.datasourceId;\r\n      });\r\n      this.datasourceBox = true;\r\n    },\r\n    handlePackage() {\r\n      if (this.selectionList.length === 0) {\r\n        this.$message.warning(\"请选择至少一条数据\");\r\n        return;\r\n      }\r\n      if (this.selectionList.length !== 1) {\r\n        this.$message.warning(\"只能选择一条数据\");\r\n        return;\r\n      }\r\n      if (this.selectionList.length === 1) {\r\n        packageInfo(this.selectionList[0].id).then(res => {\r\n          const data = res.data.data;\r\n          this.packageForm.packageId = data.id;\r\n          this.packageForm.menuId = data.menuId;\r\n        });\r\n      } else {\r\n        this.packageForm.menuId = '';\r\n      }\r\n      this.packageBox = true;\r\n      //更新字典远程数据\r\n      setTimeout(() => {\r\n        const form = this.$refs.formPackage;\r\n        form.updateDic('packageId');\r\n      }, 10);\r\n    },\r\n    handlePackageSetting() {\r\n      this.packageSettingBox = true;\r\n    },\r\n    handleSubmit(form, done, loading) {\r\n      setting(this.ids, form).then(() => {\r\n        this.onLoad(this.page);\r\n        this.$message({\r\n          type: \"success\",\r\n          message: \"配置成功!\"\r\n        });\r\n        done();\r\n        this.box = false;\r\n      }, error => {\r\n        window.console.log(error);\r\n        loading();\r\n      });\r\n    },\r\n    handleDatasourceSubmit(form, done, loading) {\r\n      datasource(this.tenantId, form.datasourceId).then(() => {\r\n        this.$message({\r\n          type: \"success\",\r\n          message: \"配置成功!\"\r\n        });\r\n        done();\r\n        this.datasourceBox = false;\r\n      }, error => {\r\n        window.console.log(error);\r\n        loading();\r\n      });\r\n    },\r\n    handlePackageSubmit(form, done, loading) {\r\n      packageSetting(this.tenantId, form.packageId).then(() => {\r\n        this.onLoad(this.page);\r\n        this.$message({\r\n          type: \"success\",\r\n          message: \"配置成功!\"\r\n        });\r\n        done();\r\n        this.packageBox = false;\r\n      }, error => {\r\n        window.console.log(error);\r\n        loading();\r\n      });\r\n    },\r\n    currentChange(currentPage) {\r\n      this.page.currentPage = currentPage;\r\n    },\r\n    sizeChange(pageSize) {\r\n      this.page.pageSize = pageSize;\r\n    },\r\n    refreshChange() {\r\n      this.onLoad(this.page, this.query);\r\n    },\r\n    onLoad(page, params = {}) {\r\n      this.loading = true;\r\n      getList(page.currentPage, page.pageSize, Object.assign(params, this.query)).then(res => {\r\n        const data = res.data.data;\r\n        this.page.total = data.total;\r\n        this.data = data.records;\r\n        this.loading = false;\r\n        this.selectionClear();\r\n      });\r\n    }\r\n  }\r\n};\r\n",{"version":3,"sources":["tenant.vue"],"names":[],"mappings":";AAkGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"tenant.vue","sourceRoot":"src/views/system","sourcesContent":["<template>\r\n  <basic-container>\r\n    <avue-crud :option=\"option\"\r\n               :table-loading=\"loading\"\r\n               :data=\"data\"\r\n               ref=\"crud\"\r\n               v-model=\"form\"\r\n               :page.sync=\"page\"\r\n               :permission=\"permissionList\"\r\n               :before-open=\"beforeOpen\"\r\n               @row-del=\"rowDel\"\r\n               @row-update=\"rowUpdate\"\r\n               @row-save=\"rowSave\"\r\n               @search-change=\"searchChange\"\r\n               @search-reset=\"searchReset\"\r\n               @selection-change=\"selectionChange\"\r\n               @current-change=\"currentChange\"\r\n               @size-change=\"sizeChange\"\r\n               @refresh-change=\"refreshChange\"\r\n               @on-load=\"onLoad\">\r\n      <template slot=\"menuLeft\">\r\n        <el-button type=\"danger\"\r\n                   size=\"small\"\r\n                   icon=\"el-icon-delete\"\r\n                   v-if=\"permission.tenant_delete\"\r\n                   plain\r\n                   @click=\"handleDelete\">删 除\r\n        </el-button>\r\n        <el-tooltip class=\"item\" effect=\"dark\" content=\"给租户配置账号额度、过期时间等授权信息\" placement=\"top\">\r\n          <el-button size=\"small\"\r\n                     plain\r\n                     v-if=\"userInfo.role_name.includes('administrator')\"\r\n                     icon=\"el-icon-setting\"\r\n                     @click=\"handleSetting\">授权配置\r\n          </el-button>\r\n        </el-tooltip>\r\n        <el-tooltip class=\"item\" effect=\"dark\" content=\"给租户配置独立数据源以实现数据库隔离\" placement=\"top\">\r\n          <el-button size=\"small\"\r\n                     plain\r\n                     v-if=\"userInfo.role_name.includes('administrator')\"\r\n                     icon=\"el-icon-coin\"\r\n                     @click=\"handleDatasource\">数据源配置\r\n          </el-button>\r\n        </el-tooltip>\r\n        <el-tooltip class=\"item\" effect=\"dark\" content=\"将菜单产品包与租户配置绑定\" placement=\"top\">\r\n          <el-button size=\"small\"\r\n                     plain\r\n                     v-if=\"userInfo.role_name.includes('administrator')\"\r\n                     icon=\"el-icon-notebook-1\"\r\n                     @click=\"handlePackage\">产品包配置\r\n          </el-button>\r\n        </el-tooltip>\r\n        <el-tooltip class=\"item\" effect=\"dark\" content=\"将自定义的菜单集合定制为租户绑定的菜单产品包\" placement=\"top\">\r\n          <el-button size=\"small\"\r\n                     plain\r\n                     v-if=\"userInfo.role_name.includes('administrator')\"\r\n                     icon=\"el-icon-notebook-2\"\r\n                     @click=\"handlePackageSetting\">产品包管理\r\n          </el-button>\r\n        </el-tooltip>\r\n      </template>\r\n      <template slot-scope=\"{row}\"\r\n                slot=\"accountNumber\">\r\n        <el-tag>{{ row.accountNumber > 0 ? row.accountNumber : '不限制' }}</el-tag>\r\n      </template>\r\n      <template slot-scope=\"{row}\"\r\n                slot=\"expireTime\">\r\n        <el-tag>{{ row.expireTime ? row.expireTime : '不限制' }}</el-tag>\r\n      </template>\r\n    </avue-crud>\r\n    <el-dialog title=\"租户授权配置\"\r\n               append-to-body\r\n               :visible.sync=\"box\"\r\n               width=\"450px\">\r\n      <avue-form :option=\"settingOption\" v-model=\"settingForm\" @submit=\"handleSubmit\"/>\r\n    </el-dialog>\r\n    <el-dialog title=\"租户数据源配置\"\r\n               append-to-body\r\n               :visible.sync=\"datasourceBox\"\r\n               width=\"450px\">\r\n      <avue-form :option=\"datasourceOption\" v-model=\"datasourceForm\" @submit=\"handleDatasourceSubmit\"/>\r\n    </el-dialog>\r\n    <el-dialog title=\"租户产品包配置\"\r\n               append-to-body\r\n               :visible.sync=\"packageBox\"\r\n               width=\"450px\">\r\n      <avue-form ref=\"formPackage\" :option=\"packageOption\" v-model=\"packageForm\" @submit=\"handlePackageSubmit\"/>\r\n    </el-dialog>\r\n    <el-dialog title=\"租户产品包管理\"\r\n               append-to-body\r\n               :visible.sync=\"packageSettingBox\"\r\n               width=\"1000px\">\r\n      <tenant-package></tenant-package>\r\n    </el-dialog>\r\n  </basic-container>\r\n</template>\r\n\r\n<script>\r\nimport {getList, getDetail, remove, update, add, setting, datasource, packageInfo, packageSetting} from \"@/api/system/tenant\";\r\nimport {getDetail as packageDetail} from \"@/api/system/tenantpackage\";\r\nimport {mapGetters} from \"vuex\";\r\nimport {getMenuTree} from \"@/api/system/menu\";\r\nimport {validatenull} from \"@/util/validate\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      form: {},\r\n      selectionList: [],\r\n      query: {},\r\n      loading: true,\r\n      box: false,\r\n      datasourceBox: false,\r\n      packageBox: false,\r\n      packageSettingBox: false,\r\n      page: {\r\n        pageSize: 10,\r\n        currentPage: 1,\r\n        total: 0\r\n      },\r\n      option: {\r\n        height: 'auto',\r\n        calcHeight: 30,\r\n        tip: false,\r\n        searchShow: true,\r\n        searchMenuSpan: 6,\r\n        border: true,\r\n        index: true,\r\n        selection: true,\r\n        viewBtn: true,\r\n        dialogWidth: 900,\r\n        dialogClickModal: false,\r\n        column: [\r\n          {\r\n            label: \"租户ID\",\r\n            prop: \"tenantId\",\r\n            width: 100,\r\n            search: true,\r\n            addDisplay: false,\r\n            editDisplay: false,\r\n            span: 24,\r\n            rules: [{\r\n              required: true,\r\n              message: \"请输入租户ID\",\r\n              trigger: \"blur\"\r\n            }]\r\n          },\r\n          {\r\n            label: \"租户名称\",\r\n            prop: \"tenantName\",\r\n            search: true,\r\n            width: 180,\r\n            span: 24,\r\n            rules: [{\r\n              required: true,\r\n              message: \"请输入参数名称\",\r\n              trigger: \"blur\"\r\n            }]\r\n          },\r\n          {\r\n            label: \"联系人\",\r\n            prop: \"linkman\",\r\n            width: 100,\r\n            search: true,\r\n            rules: [{\r\n              required: true,\r\n              message: \"请输入联系人\",\r\n              trigger: \"blur\"\r\n            }]\r\n          },\r\n          {\r\n            label: \"联系电话\",\r\n            prop: \"contactNumber\",\r\n            width: 150,\r\n          },\r\n          {\r\n            label: \"联系地址\",\r\n            prop: \"address\",\r\n            span: 24,\r\n            minRows: 2,\r\n            type: \"textarea\",\r\n            hide: true,\r\n          },\r\n          {\r\n            label: \"账号额度\",\r\n            prop: \"accountNumber\",\r\n            width: 90,\r\n            slot: true,\r\n            addDisplay: false,\r\n            editDisplay: false,\r\n          },\r\n          {\r\n            label: \"过期时间\",\r\n            prop: \"expireTime\",\r\n            width: 180,\r\n            slot: true,\r\n            addDisplay: false,\r\n            editDisplay: false,\r\n          },\r\n          {\r\n            label: \"绑定域名\",\r\n            prop: \"domain\",\r\n            span: 24,\r\n          },\r\n          {\r\n            label: \"系统背景\",\r\n            prop: \"backgroundUrl\",\r\n            type: 'upload',\r\n            listType: 'picture-img',\r\n            dataType: 'string',\r\n            action: '/api/blade-resource/oss/endpoint/put-file',\r\n            propsHttp: {\r\n              res: 'data',\r\n              url: 'link',\r\n            },\r\n            hide: true,\r\n            span: 24,\r\n          },\r\n        ]\r\n      },\r\n      data: [],\r\n      settingForm: {},\r\n      settingOption: {\r\n        column: [\r\n          {\r\n            label: \"账号额度\",\r\n            prop: \"accountNumber\",\r\n            type: \"number\",\r\n            span: 24,\r\n          },\r\n          {\r\n            label: \"过期时间\",\r\n            prop: \"expireTime\",\r\n            type: \"date\",\r\n            format: \"yyyy-MM-dd hh:mm:ss\",\r\n            valueFormat: \"yyyy-MM-dd hh:mm:ss\",\r\n            span: 24,\r\n          },\r\n        ]\r\n      },\r\n      datasourceForm: {},\r\n      datasourceOption: {\r\n        column: [\r\n          {\r\n            label: \"数据源\",\r\n            prop: \"datasourceId\",\r\n            search: true,\r\n            span: 24,\r\n            type: \"select\",\r\n            dicUrl: \"/api/blade-develop/datasource/select\",\r\n            props: {\r\n              label: \"name\",\r\n              value: \"id\"\r\n            },\r\n            rules: [{\r\n              required: true,\r\n              message: \"请选择数据源\",\r\n              trigger: \"blur\"\r\n            }]\r\n          },\r\n        ]\r\n      },\r\n      packageForm: {},\r\n      packageOption: {\r\n        column: [\r\n          {\r\n            label: \"产品包\",\r\n            prop: \"packageId\",\r\n            search: true,\r\n            span: 24,\r\n            type: \"select\",\r\n            dicUrl: \"/api/blade-system/tenant-package/select\",\r\n            props: {\r\n              label: \"packageName\",\r\n              value: \"id\"\r\n            },\r\n            rules: [{\r\n              required: true,\r\n              message: \"请选择产品包\",\r\n              trigger: \"blur\"\r\n            }]\r\n          },\r\n          {\r\n            label: \"菜单预览\",\r\n            prop: \"menuId\",\r\n            span: 24,\r\n            type: \"tree\",\r\n            dicData: [],\r\n            hide: true,\r\n            multiple: true,\r\n            props: {\r\n              label: \"title\"\r\n            },\r\n          },\r\n        ]\r\n      },\r\n    };\r\n  },\r\n  watch: {\r\n    'packageForm.packageId'() {\r\n      if (!validatenull(this.packageForm.packageId)) {\r\n        packageDetail(this.packageForm.packageId).then(res => {\r\n          this.packageForm.menuId = res.data.data.menuId;\r\n          this.initData();\r\n        });\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapGetters([\"userInfo\", \"permission\"]),\r\n    permissionList() {\r\n      return {\r\n        addBtn: this.vaildData(this.permission.tenant_add, false),\r\n        viewBtn: this.vaildData(this.permission.tenant_view, false),\r\n        delBtn: this.vaildData(this.permission.tenant_delete, false),\r\n        editBtn: this.vaildData(this.permission.tenant_edit, false)\r\n      };\r\n    },\r\n    ids() {\r\n      let ids = [];\r\n      this.selectionList.forEach(ele => {\r\n        ids.push(ele.id);\r\n      });\r\n      return ids.join(\",\");\r\n    },\r\n    tenantId() {\r\n      return this.selectionList[0].tenantId;\r\n    }\r\n  },\r\n  methods: {\r\n    initData() {\r\n      getMenuTree().then(res => {\r\n        const column = this.findObject(this.packageOption.column, \"menuId\");\r\n        column.dicData = res.data.data;\r\n      });\r\n    },\r\n    rowSave(row, done, loading) {\r\n      add(row).then(() => {\r\n        this.onLoad(this.page);\r\n        this.$message({\r\n          type: \"success\",\r\n          message: \"操作成功!\"\r\n        });\r\n        done();\r\n      }, error => {\r\n        window.console.log(error);\r\n        loading();\r\n      });\r\n    },\r\n    rowUpdate(row, index, done, loading) {\r\n      update(row).then(() => {\r\n        this.onLoad(this.page);\r\n        this.$message({\r\n          type: \"success\",\r\n          message: \"操作成功!\"\r\n        });\r\n        done();\r\n      }, error => {\r\n        window.console.log(error);\r\n        loading();\r\n      });\r\n    },\r\n    rowDel(row) {\r\n      this.$confirm(\"确定将选择数据删除?\", {\r\n        confirmButtonText: \"确定\",\r\n        cancelButtonText: \"取消\",\r\n        type: \"warning\"\r\n      })\r\n        .then(() => {\r\n          return remove(row.id);\r\n        })\r\n        .then(() => {\r\n          this.onLoad(this.page);\r\n          this.$message({\r\n            type: \"success\",\r\n            message: \"操作成功!\"\r\n          });\r\n        });\r\n    },\r\n    beforeOpen(done, type) {\r\n      if ([\"view\"].includes(type)) {\r\n        getDetail(this.form.id).then(res => {\r\n          const data = res.data.data;\r\n          if (!(data.accountNumber > 0)) {\r\n            data.accountNumber = \"不限制\";\r\n          }\r\n          if (!data.expireTime) {\r\n            data.expireTime = \"不限制\";\r\n          }\r\n          this.form = data;\r\n        });\r\n      }\r\n      done();\r\n    },\r\n    searchReset() {\r\n      this.query = {};\r\n      this.onLoad(this.page);\r\n    },\r\n    searchChange(params, done) {\r\n      this.query = params;\r\n      this.page.currentPage = 1;\r\n      this.onLoad(this.page, params);\r\n      done();\r\n    },\r\n    selectionChange(list) {\r\n      this.selectionList = list;\r\n    },\r\n    selectionClear() {\r\n      this.selectionList = [];\r\n      this.$refs.crud.toggleSelection();\r\n    },\r\n    handleDelete() {\r\n      if (this.selectionList.length === 0) {\r\n        this.$message.warning(\"请选择至少一条数据\");\r\n        return;\r\n      }\r\n      this.$confirm(\"确定将选择数据删除?\", {\r\n        confirmButtonText: \"确定\",\r\n        cancelButtonText: \"取消\",\r\n        type: \"warning\"\r\n      })\r\n        .then(() => {\r\n          return remove(this.ids);\r\n        })\r\n        .then(() => {\r\n          this.onLoad(this.page);\r\n          this.$message({\r\n            type: \"success\",\r\n            message: \"操作成功!\"\r\n          });\r\n          this.$refs.crud.toggleSelection();\r\n        });\r\n    },\r\n    handleSetting() {\r\n      if (this.selectionList.length === 0) {\r\n        this.$message.warning(\"请选择至少一条数据\");\r\n        return;\r\n      }\r\n      if (this.selectionList.length === 1) {\r\n        getDetail(this.selectionList[0].id).then(res => {\r\n          const data = res.data.data;\r\n          this.settingForm.accountNumber = data.accountNumber;\r\n          this.settingForm.expireTime = data.expireTime;\r\n        });\r\n      } else {\r\n        this.settingForm.accountNumber = -1;\r\n        this.settingForm.expireTime = '';\r\n      }\r\n      this.box = true;\r\n    },\r\n    handleDatasource() {\r\n      if (this.selectionList.length === 0) {\r\n        this.$message.warning(\"请选择至少一条数据\");\r\n        return;\r\n      }\r\n      if (this.selectionList.length !== 1) {\r\n        this.$message.warning(\"只能选择一条数据\");\r\n        return;\r\n      }\r\n      getDetail(this.selectionList[0].id).then(res => {\r\n        const data = res.data.data;\r\n        this.datasourceForm.datasourceId = data.datasourceId;\r\n      });\r\n      this.datasourceBox = true;\r\n    },\r\n    handlePackage() {\r\n      if (this.selectionList.length === 0) {\r\n        this.$message.warning(\"请选择至少一条数据\");\r\n        return;\r\n      }\r\n      if (this.selectionList.length !== 1) {\r\n        this.$message.warning(\"只能选择一条数据\");\r\n        return;\r\n      }\r\n      if (this.selectionList.length === 1) {\r\n        packageInfo(this.selectionList[0].id).then(res => {\r\n          const data = res.data.data;\r\n          this.packageForm.packageId = data.id;\r\n          this.packageForm.menuId = data.menuId;\r\n        });\r\n      } else {\r\n        this.packageForm.menuId = '';\r\n      }\r\n      this.packageBox = true;\r\n      //更新字典远程数据\r\n      setTimeout(() => {\r\n        const form = this.$refs.formPackage;\r\n        form.updateDic('packageId');\r\n      }, 10);\r\n    },\r\n    handlePackageSetting() {\r\n      this.packageSettingBox = true;\r\n    },\r\n    handleSubmit(form, done, loading) {\r\n      setting(this.ids, form).then(() => {\r\n        this.onLoad(this.page);\r\n        this.$message({\r\n          type: \"success\",\r\n          message: \"配置成功!\"\r\n        });\r\n        done();\r\n        this.box = false;\r\n      }, error => {\r\n        window.console.log(error);\r\n        loading();\r\n      });\r\n    },\r\n    handleDatasourceSubmit(form, done, loading) {\r\n      datasource(this.tenantId, form.datasourceId).then(() => {\r\n        this.$message({\r\n          type: \"success\",\r\n          message: \"配置成功!\"\r\n        });\r\n        done();\r\n        this.datasourceBox = false;\r\n      }, error => {\r\n        window.console.log(error);\r\n        loading();\r\n      });\r\n    },\r\n    handlePackageSubmit(form, done, loading) {\r\n      packageSetting(this.tenantId, form.packageId).then(() => {\r\n        this.onLoad(this.page);\r\n        this.$message({\r\n          type: \"success\",\r\n          message: \"配置成功!\"\r\n        });\r\n        done();\r\n        this.packageBox = false;\r\n      }, error => {\r\n        window.console.log(error);\r\n        loading();\r\n      });\r\n    },\r\n    currentChange(currentPage) {\r\n      this.page.currentPage = currentPage;\r\n    },\r\n    sizeChange(pageSize) {\r\n      this.page.pageSize = pageSize;\r\n    },\r\n    refreshChange() {\r\n      this.onLoad(this.page, this.query);\r\n    },\r\n    onLoad(page, params = {}) {\r\n      this.loading = true;\r\n      getList(page.currentPage, page.pageSize, Object.assign(params, this.query)).then(res => {\r\n        const data = res.data.data;\r\n        this.page.total = data.total;\r\n        this.data = data.records;\r\n        this.loading = false;\r\n        this.selectionClear();\r\n      });\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style>\r\n</style>\r\n"]}]}