{"remainingRequest":"/Users/shiliangliang/6cloud/saber/node_modules/babel-loader/lib/index.js!/Users/shiliangliang/6cloud/saber/node_modules/eslint-loader/index.js??ref--13-0!/Users/shiliangliang/6cloud/saber/src/permission.js","dependencies":[{"path":"/Users/shiliangliang/6cloud/saber/src/permission.js","mtime":1675305945985},{"path":"/Users/shiliangliang/6cloud/saber/babel.config.js","mtime":1675244276424},{"path":"/Users/shiliangliang/6cloud/saber/node_modules/cache-loader/dist/cjs.js","mtime":1676864065065},{"path":"/Users/shiliangliang/6cloud/saber/node_modules/babel-loader/lib/index.js","mtime":1676864056051},{"path":"/Users/shiliangliang/6cloud/saber/node_modules/eslint-loader/index.js","mtime":1676864063827}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\n/**\r\n * 全站权限配置\r\n *\r\n */\nimport router from \"./router/router\";\nimport store from \"./store\";\nimport { validatenull } from '@/util/validate';\nimport { getToken } from '@/util/auth';\nimport NProgress from 'nprogress'; // progress bar\nimport 'nprogress/nprogress.css'; // progress bar style\nNProgress.configure({\n  showSpinner: false\n});\nvar lockPage = store.getters.website.lockPage; //锁屏页\nrouter.beforeEach(function (to, from, next) {\n  var meta = to.meta || {};\n  var isMenu = meta.menu === undefined ? to.query.menu : meta.menu;\n  store.commit('SET_IS_MENU', isMenu === undefined);\n  if (getToken()) {\n    if (store.getters.isLock && to.path !== lockPage) {\n      //如果系统激活锁屏，全部跳转到锁屏页\n      next({\n        path: lockPage\n      });\n    } else if (to.path === '/login') {\n      //如果登录成功访问登录页跳转到主页\n      next({\n        path: '/'\n      });\n    } else {\n      //如果用户信息为空则获取用户信息，获取用户信息失败，跳转到登录页\n      if (store.getters.token.length === 0) {\n        store.dispatch('FedLogOut').then(function () {\n          next({\n            path: '/login'\n          });\n        });\n      } else {\n        var value = to.query.src || to.fullPath;\n        var label = to.query.name || to.name;\n        var _meta = to.meta || router.$avueRouter.meta || {};\n        var i18n = to.query.i18n;\n        if (to.query.target) {\n          window.open(value);\n        } else if (_meta.isTab !== false && !validatenull(value) && !validatenull(label)) {\n          store.commit('ADD_TAG', {\n            label: label,\n            value: value,\n            params: to.params,\n            query: to.query,\n            meta: function () {\n              if (!i18n) {\n                return _meta;\n              }\n              return {\n                i18n: i18n\n              };\n            }(),\n            group: router.$avueRouter.group || []\n          });\n        }\n        next();\n      }\n    }\n  } else {\n    //判断是否需要认证，没有登录访问去登录页\n    if (meta.isAuth === false) {\n      next();\n    } else {\n      next('/login');\n    }\n  }\n});\nrouter.afterEach(function () {\n  NProgress.done();\n  var title = store.getters.tag.label;\n  var i18n = store.getters.tag.meta.i18n;\n  title = router.$avueRouter.generateTitle(title, i18n);\n  //判断登录页的情况\n  if (router.history.current.fullPath === \"/login\") {\n    title = \"登录\";\n  }\n  //根据当前的标签也获取label的值动态设置浏览器标题\n  router.$avueRouter.setTitle(title);\n});",{"version":3,"names":["router","store","validatenull","getToken","NProgress","configure","showSpinner","lockPage","getters","website","beforeEach","to","from","next","meta","isMenu","menu","undefined","query","commit","isLock","path","token","length","dispatch","then","value","src","fullPath","label","name","$avueRouter","i18n","target","window","open","isTab","params","group","isAuth","afterEach","done","title","tag","generateTitle","history","current","setTitle"],"sources":["/Users/shiliangliang/6cloud/saber/src/permission.js"],"sourcesContent":["/**\r\n * 全站权限配置\r\n *\r\n */\r\nimport router from './router/router'\r\nimport store from './store'\r\nimport {validatenull} from '@/util/validate'\r\nimport {getToken} from '@/util/auth'\r\nimport NProgress from 'nprogress' // progress bar\r\nimport 'nprogress/nprogress.css' // progress bar style\r\nNProgress.configure({showSpinner: false});\r\nconst lockPage = store.getters.website.lockPage; //锁屏页\r\nrouter.beforeEach((to, from, next) => {\r\n  const meta = to.meta || {};\r\n  const isMenu = meta.menu === undefined ? to.query.menu : meta.menu;\r\n  store.commit('SET_IS_MENU', isMenu === undefined);\r\n  if (getToken()) {\r\n    if (store.getters.isLock && to.path !== lockPage) { //如果系统激活锁屏，全部跳转到锁屏页\r\n      next({path: lockPage})\r\n    } else if (to.path === '/login') { //如果登录成功访问登录页跳转到主页\r\n      next({path: '/'})\r\n    } else {\r\n      //如果用户信息为空则获取用户信息，获取用户信息失败，跳转到登录页\r\n      if (store.getters.token.length === 0) {\r\n        store.dispatch('FedLogOut').then(() => {\r\n          next({path: '/login'})\r\n        })\r\n      } else {\r\n        const value = to.query.src || to.fullPath;\r\n        const label = to.query.name || to.name;\r\n        const meta = to.meta || router.$avueRouter.meta || {};\r\n        const i18n = to.query.i18n;\r\n        if (to.query.target) {\r\n          window.open(value)\r\n        } else if (meta.isTab !== false && !validatenull(value) && !validatenull(label)) {\r\n          store.commit('ADD_TAG', {\r\n            label: label,\r\n            value: value,\r\n            params: to.params,\r\n            query: to.query,\r\n            meta: (() => {\r\n              if (!i18n) {\r\n                return meta\r\n              }\r\n              return {\r\n                i18n: i18n\r\n              }\r\n            })(),\r\n            group: router.$avueRouter.group || []\r\n          });\r\n        }\r\n        next()\r\n      }\r\n    }\r\n  } else {\r\n    //判断是否需要认证，没有登录访问去登录页\r\n    if (meta.isAuth === false) {\r\n      next()\r\n    } else {\r\n      next('/login')\r\n    }\r\n  }\r\n})\r\n\r\nrouter.afterEach(() => {\r\n  NProgress.done();\r\n  let title = store.getters.tag.label;\r\n  let i18n = store.getters.tag.meta.i18n;\r\n  title = router.$avueRouter.generateTitle(title, i18n);\r\n  //判断登录页的情况\r\n  if (router.history.current.fullPath === \"/login\") {\r\n    title = \"登录\";\r\n  }\r\n  //根据当前的标签也获取label的值动态设置浏览器标题\r\n  router.$avueRouter.setTitle(title);\r\n});\r\n"],"mappings":"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"}]}