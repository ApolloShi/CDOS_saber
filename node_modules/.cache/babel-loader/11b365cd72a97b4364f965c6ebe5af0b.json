{"remainingRequest":"/Users/shiliangliang/6cloud/saber/node_modules/babel-loader/lib/index.js!/Users/shiliangliang/6cloud/saber/node_modules/eslint-loader/index.js??ref--13-0!/Users/shiliangliang/6cloud/saber/src/router/axios.js","dependencies":[{"path":"/Users/shiliangliang/6cloud/saber/src/router/axios.js","mtime":1675244276611},{"path":"/Users/shiliangliang/6cloud/saber/babel.config.js","mtime":1675244276424},{"path":"/Users/shiliangliang/6cloud/saber/node_modules/cache-loader/dist/cjs.js","mtime":1676864065065},{"path":"/Users/shiliangliang/6cloud/saber/node_modules/babel-loader/lib/index.js","mtime":1676864056051},{"path":"/Users/shiliangliang/6cloud/saber/node_modules/eslint-loader/index.js","mtime":1676864063827}],"contextDependencies":[],"result":["import \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\n/**\r\n * 全站http配置\r\n *\r\n * axios参数说明\r\n * isSerialize是否开启form表单提交\r\n * isToken是否需要token\r\n */\nimport axios from 'axios';\nimport store from '@/store/';\nimport router from '@/router/router';\nimport { serialize } from '@/util/util';\nimport { getToken } from '@/util/auth';\nimport { Message } from 'element-ui';\nimport website from '@/config/website';\nimport { Base64 } from 'js-base64';\nimport NProgress from 'nprogress';\nimport 'nprogress/nprogress.css';\n\n//默认超时时间\naxios.defaults.timeout = 10000;\n//返回其他状态码\naxios.defaults.validateStatus = function (status) {\n  return status >= 200 && status <= 500;\n};\n//跨域请求，允许保存cookie\naxios.defaults.withCredentials = true;\n// NProgress 配置\nNProgress.configure({\n  showSpinner: false\n});\n//http request拦截\naxios.interceptors.request.use(function (config) {\n  //开启 progress bar\n  NProgress.start();\n  var meta = config.meta || {};\n  var isToken = meta.isToken === false;\n  config.headers['Authorization'] = \"Basic \".concat(Base64.encode(\"\".concat(website.clientId, \":\").concat(website.clientSecret)));\n  //让每个请求携带token\n  if (getToken() && !isToken) {\n    config.headers[website.tokenHeader] = 'bearer ' + getToken();\n  }\n  //headers中配置text请求\n  if (config.text === true) {\n    config.headers[\"Content-Type\"] = \"text/plain\";\n  }\n  //headers中配置serialize为true开启序列化\n  if (config.method === 'post' && meta.isSerialize === true) {\n    config.data = serialize(config.data);\n  }\n  return config;\n}, function (error) {\n  return Promise.reject(error);\n});\n//http response 拦截\naxios.interceptors.response.use(function (res) {\n  //关闭 progress bar\n  NProgress.done();\n  //获取状态码\n  var status = res.data.code || res.status;\n  var statusWhiteList = website.statusWhiteList || [];\n  var message = res.data.msg || res.data.error_description || '未知错误';\n  //如果在白名单里则自行catch逻辑处理\n  if (statusWhiteList.includes(status)) return Promise.reject(res);\n  //如果是401则跳转到登录页面\n  if (status === 401) store.dispatch('FedLogOut').then(function () {\n    return router.push({\n      path: '/login'\n    });\n  });\n  // 如果请求为非200否者默认统一处理\n  if (status !== 200) {\n    Message({\n      message: message,\n      type: 'error'\n    });\n    return Promise.reject(new Error(message));\n  }\n  return res;\n}, function (error) {\n  NProgress.done();\n  return Promise.reject(new Error(error));\n});\nexport default axios;",{"version":3,"names":["axios","store","router","serialize","getToken","Message","website","Base64","NProgress","defaults","timeout","validateStatus","status","withCredentials","configure","showSpinner","interceptors","request","use","config","start","meta","isToken","headers","encode","clientId","clientSecret","tokenHeader","text","method","isSerialize","data","error","Promise","reject","response","res","done","code","statusWhiteList","message","msg","error_description","includes","dispatch","then","push","path","type","Error"],"sources":["/Users/shiliangliang/6cloud/saber/src/router/axios.js"],"sourcesContent":["/**\r\n * 全站http配置\r\n *\r\n * axios参数说明\r\n * isSerialize是否开启form表单提交\r\n * isToken是否需要token\r\n */\r\nimport axios from 'axios';\r\nimport store from '@/store/';\r\nimport router from '@/router/router';\r\nimport {serialize} from '@/util/util';\r\nimport {getToken} from '@/util/auth';\r\nimport {Message} from 'element-ui';\r\nimport website from '@/config/website';\r\nimport {Base64} from 'js-base64';\r\nimport NProgress from 'nprogress';\r\nimport 'nprogress/nprogress.css';\r\n\r\n//默认超时时间\r\naxios.defaults.timeout = 10000;\r\n//返回其他状态码\r\naxios.defaults.validateStatus = function (status) {\r\n  return status >= 200 && status <= 500;\r\n};\r\n//跨域请求，允许保存cookie\r\naxios.defaults.withCredentials = true;\r\n// NProgress 配置\r\nNProgress.configure({\r\n  showSpinner: false\r\n});\r\n//http request拦截\r\naxios.interceptors.request.use(config => {\r\n  //开启 progress bar\r\n  NProgress.start();\r\n  const meta = (config.meta || {});\r\n  const isToken = meta.isToken === false;\r\n  config.headers['Authorization'] = `Basic ${Base64.encode(`${website.clientId}:${website.clientSecret}`)}`;\r\n  //让每个请求携带token\r\n  if (getToken() && !isToken) {\r\n    config.headers[website.tokenHeader] = 'bearer ' + getToken()\r\n  }\r\n  //headers中配置text请求\r\n  if (config.text === true) {\r\n    config.headers[\"Content-Type\"] = \"text/plain\";\r\n  }\r\n  //headers中配置serialize为true开启序列化\r\n  if (config.method === 'post' && meta.isSerialize === true) {\r\n    config.data = serialize(config.data);\r\n  }\r\n  return config\r\n}, error => {\r\n  return Promise.reject(error)\r\n});\r\n//http response 拦截\r\naxios.interceptors.response.use(res => {\r\n  //关闭 progress bar\r\n  NProgress.done();\r\n  //获取状态码\r\n  const status = res.data.code || res.status;\r\n  const statusWhiteList = website.statusWhiteList || [];\r\n  const message = res.data.msg || res.data.error_description || '未知错误';\r\n  //如果在白名单里则自行catch逻辑处理\r\n  if (statusWhiteList.includes(status)) return Promise.reject(res);\r\n  //如果是401则跳转到登录页面\r\n  if (status === 401) store.dispatch('FedLogOut').then(() => router.push({path: '/login'}));\r\n  // 如果请求为非200否者默认统一处理\r\n  if (status !== 200) {\r\n    Message({\r\n      message: message,\r\n      type: 'error'\r\n    });\r\n    return Promise.reject(new Error(message))\r\n  }\r\n  return res;\r\n}, error => {\r\n  NProgress.done();\r\n  return Promise.reject(new Error(error));\r\n});\r\n\r\nexport default axios;\r\n"],"mappings":"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"}]}